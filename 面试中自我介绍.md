# 面试中自我介绍

[TOC]

#### 面试中自我介绍

该问什么：

1）负责的工作内容是哪个模块

2）是否有导师带

3）毕业之后还能不能去公司上班

优点：

1）：做事比较有耐心和毅力，做事不多

#### RDB与AOF持久化

**RDB**：将当前进程中数据生成快照保存在硬盘中，保存文件的后缀为rdb，当redis重启时，可以读取快照文件恢复数据

**触发方式**

1.手动触发

2.自动触发

1）手动触发

使用save命令或bgsave命令可以生成rdb文件

- save会阻塞进程，在redis服务器阻塞期间服务器不能处理命令任何请求
- bgsave会创建一个子进程，子进程负责创建rdb文件，父进程（即Redis主进程）继续处理请求
- bgsave中只有fork子进程阻塞服务器，而save命令整个过程都会阻塞服务器。

2）自动触发

- save m n 

​      常见的情况是在配置文件中通过save m n ，指定m秒内发生n次变化，会触发bgsave

- save m n 原理 通过serverCron函数，dirty计数器，和lastsave时间戳来实现的。
- serverCron是Redis服务器的**周期性操作函数**，默认每隔100ms执行一次；该函数对服务器的状态进行维护，**其中一项工作就是检查 save m n 配置的条件是否满足，如果满足就执行bgsave**。
- dirty计数器是**Redis服务器维持的一个状态**，记录了上一次执行bgsave/save命令后，服务器状态进行了多少次修改(包括增删改)；**而当save/bgsave执行完成后，会将dirty重新置为0**。
- lastsave时间戳也是Redis服务器维持的一个状态，记录的是上一次成功执行save/bgsave的时间。

**save m n的原理如下：**每隔100ms，执行serverCron函数；在serverCron函数中，遍历save m n配置的保存条件，只要有一个条件满足，就进行bgsave。对于每一个save m n条件，只有下面两条同时满足时才算满足：

（1）当前时间-lastsave > m

（2）dirty >= n



**AOF：**将redis执行的每次写命令记录到单独的日志文件中；当redis重启时在次执行AOF命令来恢复数据，AOF优先级更高，因此当AOF开启时，redis会优先加载AOF文件来恢复数据，只有AOF关闭时，才会自动检测rdb文件



**执行流程**

由于需要记录Redis的每条写命令，因此AOF不需要触发，下面介绍AOF的执行流程。

AOF的执行流程包括：

- 命令追加(append)：将Redis的写命令追加到缓冲区aof_buf；
- 文件写入(write)和文件同步(sync)：根据不同的同步策略将aof_buf中的内容同步到硬盘；
- 文件重写(rewrite)：定期重写AOF文件，达到压缩的目的。

**这样的操作虽然提高了效率，但也带来了安全问题：**如果计算机停机，内存缓冲区中的数据会丢失；因此系统同时提供了fsync、fdatasync等同步函数，可以强制操作系统立刻将缓冲区中的数据写入到硬盘里，从而确保数据的安全性。



**关于文件重写需要注意的另一点是：**对于AOF持久化来说，文件重写虽然是强烈推荐的，但并不是必须的；即使没有文件重写，数据也可以被持久化并在Redis启动的时候导入；因此在一些实现中，会关闭自动的文件重写，然后通过定时任务在每天的某一时刻定时执行。

 **文件重写分为手动触发和自动触发**



**文件重写之所以能够压缩AOF文件，原因在于：**

- 过期的数据不再写入文件
- 无效的命令不再写入文件：如有些数据被重复设值(set mykey v1, set mykey v2)、有些数据被删除了(sadd myset v1, del myset)等等
- 多条命令可以合并为一个：如sadd myset v1, sadd myset v2, sadd myset v3可以合并为sadd myset v1 v2 v3。不过为了防止单条命令过大造成客户端缓冲区溢出，对于list、set、hash、zset类型的key，并不一定只使用一条命令；而是以某个常量为界将命令拆分为多条。这个常量在redis.h/REDIS_AOF_REWRITE_ITEMS_PER_CMD中定义，不可更改，3.0版本中值是64。



#### **RDB和AOF的优缺点**

**RDB持久化**

**优点：**RDB文件紧凑，体积小，网络传输快，适合全量复制；恢复速度比AOF快很多。当然，与AOF相比，RDB最重要的优点之一是对性能的影响相对较小。

**缺点：**RDB文件的致命缺点在于其数据快照的持久化方式决定了必然做不到实时持久化，而在数据越来越重要的今天，数据的大量丢失很多时候是无法接受的，因此AOF持久化成为主流。此外，RDB文件需要满足特定格式，兼容性差（如老版本的Redis不兼容新版本的RDB文件）。



**AOF持久化**

与RDB持久化相对应，AOF的优点在于支持秒级持久化、兼容性好，缺点是文件大、恢复速度慢、对性能影响大。









#### 序列化

序列化：将对象转换成字节序列的过程

1）一个类能被序列化，子类也能序列化

2）static代表类成员，transient代表对象的临时数据，这两种的数据成员是不能被序列化的

3）子类实现了Serializable接口，父类没有，父类中的属性不能序列化，但子类中的属性仍能正常序列化